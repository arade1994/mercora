<div class="product-details-page">
  <a routerLink="/products" class="back-link">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <polyline points="15 18 9 12 15 6"></polyline>
    </svg>
    Back to Products
  </a>

  @if (state() === 'loading') {
    <div class="loading-container">
      <div class="spinner"></div>
      <p class="loading-text">Loading product details...</p>
    </div>
  } @else if (state() === 'error') {
    <div class="error-container">
      <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="8" x2="12" y2="12"></line>
        <line x1="12" y1="16" x2="12.01" y2="16"></line>
      </svg>
      <p class="error-message">{{ error() }}</p>
    </div>
  } @else if (product()) {
    <div class="product-content">
      <div class="product-gallery">
        @if (product()?.primaryImageUrl || (product()?.images && product()!.images.length > 0)) {
          <div class="main-image-container">
            <img
              [src]="product()?.primaryImageUrl || product()?.images?.[0]?.url"
              [alt]="product()?.name"
              class="main-image"
            />
          </div>
        } @else {
          <div class="main-image-placeholder">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
              <circle cx="8.5" cy="8.5" r="1.5"></circle>
              <polyline points="21 15 16 10 5 21"></polyline>
            </svg>
            <p>No image available</p>
          </div>
        }

        @if (product()?.images && product()!.images.length > 1) {
          <div class="thumbnail-gallery">
            @for (img of product()?.images; track img.imageId) {
              <div class="thumbnail-container">
                <img
                  [src]="img.url"
                  [alt]="product()?.name"
                  class="thumbnail-image"
                />
              </div>
            }
          </div>
        }
      </div>

      <div class="product-info">
        <h1 class="product-title">{{ product()?.name }}</h1>
        
        <div class="product-price-section">
          <span class="price-label">Price</span>
          <span class="price-value">
            {{ product()?.currencyCode }} {{ product()?.basePrice | number:'1.2-2' }}
          </span>
        </div>

        @if (product()?.description) {
          <div class="product-description">
            <h3 class="section-title">Description</h3>
            <p class="description-text">{{ product()?.description }}</p>
          </div>
        }

        @if (product()?.variants && product()!.variants.length > 0) {
          <div class="product-variants">
            <h3 class="section-title">Available Variants</h3>
            <div class="variants-grid">
              @for (v of product()?.variants; track v.variantId) {
                <div class="variant-card" [class.inactive]="!v.isActive">
                  <div class="variant-header">
                    <div class="variant-info">
                      <div class="variant-sku">{{ v.sku }}</div>
                      <div class="variant-name">{{ v.variantName || 'Default Variant' }}</div>
                    </div>
                    <div class="variant-price">
                      {{ product()?.currencyCode }} {{ v.price | number:'1.2-2' }}
                    </div>
                  </div>
                  
                  <div class="variant-details">
                    <div class="stock-info">
                      <span class="stock-label">Stock:</span>
                      <span class="stock-value" [class.low-stock]="v.quantityOnHand <= v.reorderPoint">
                        {{ v.quantityOnHand }} units
                      </span>
                    </div>
                    @if (v.quantityOnHand <= v.reorderPoint) {
                      <div class="reorder-notice">
                        Reorder at {{ v.reorderPoint }} units
                      </div>
                    }
                  </div>
                </div>
              }
            </div>
          </div>
        }
      </div>
    </div>
  }
</div>
